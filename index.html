<!DOCTYPE html>
<html lang="en">
<head>

	<meta charset="UTF-8">
	<title>Exportaciones de productos tradicionales a Estados Unidos</title>
	<style type="text/css">
		.general{			
			font-family: 'Alegreya', serif;
			font-size: 18px;			
		}

		.label{
			font-size: 18px;
			font-family: 'Alegreya', serif;
		}
		.label2{
			font-size: 20px;
			font-family: 'Alegreya', serif;
		}
		.legend text,
		.axis text {
			font-size: 13px;
			fill: #333;
		}

		.axis path,
		.axis line{
			fill: none;
			stroke-width: 1px;
			stroke: #777;
		}

		.circle{
			fill-opacity: 0.65;
		}

		.bubble{
			opacity: 1;
			transition: opacity 0.3s;
		}

		.bubble:hover text{
			opacity: 1;
		}

		.bubble:hover circle{
			fill-opacity: 1;
		}

		.legend rect{
			fill-opacity: 0.75;
		}

		.legeng:hover rect{
			fill-opacity:1;
		}		

		div.tooltip {
		  position: absolute;
		  text-align: center;
		  width: 180px;
		  height: 70px;
		  padding: 2px;
		  font: 12px sans-serif;
		  background: #0c0c0c;
		  color: white;
		  border: 0px;
		  border-radius: 8px;
		  pointer-events: none;
		}
		
		.buttonR {
			font-size: 13px;
			fill: #333;	
			font-weight: bold;			
		}
		
		h1 {
			font-weight: bold;
			color: #fff;
			font-size: 26px;
			font-family: 'Alegreya', serif;
		}
		
		.titulo {
			font-weight: bold;
			font-family: 'Alegreya', serif;
			font-size: 46px;
			color:  #022d07;
		}
		.titulo2 {
			font-weight: bold;
			font-family: 'Alegreya', serif;
			font-size: 30px;
			color:  #022d07;
		}
		.texto {
			-webkit-column-count: 3; /* Chrome, Safari, Opera */
			-moz-column-count: ; /* Firefox */
			column-count: 2;
			-webkit-column-gap: 40px; /* Chrome, Safari, Opera */
			-moz-column-gap: 40px; /* Firefox */
			column-gap: 80px;

			text-align: justify;
			text-justify: inter-word;
			
		}
		.texto2 {
			text-align: justify;
			text-justify: inter-word;			
		}
		.parallax2 {
			/* The image used */
			background-image: url("economy2.jpg");

			/* Set a specific height */
			min-height: 200px; 
			

			/* Create the parallax scrolling effect */
			background-attachment: fixed;
			background-position: center;
			background-repeat: no-repeat;
			background-size: cover;
		}

		.parallax {
			/* The image used */
			background-image: url("economy.jpg");

			/* Set a specific height */
			min-height: 150px; 
			

			/* Create the parallax scrolling effect */
			background-attachment: fixed;
			background-position: center;
			background-repeat: no-repeat;
			background-size: cover;
		}

		
	</style>
	<link href="https://fonts.googleapis.com/css?family=Alegreya" rel="stylesheet"> 
	<script type="text/javascript" src="https://d3js.org/d3.v5.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>
<br/>
<br/>
<br/>
<div class="text-center general">
	<div class="row">
		<div class="text-center col-md-offset-3 col-md-6">
			<span class="titulo">¿Qué pasó con el TLC Colombia?</span>
			<br/><h4>
			Las exportaciones del Carbón y el Petróleo, dos de los productos más relevantes para Colombia han caído después del TLC.
			
			</h4>
		<p>	Creado por: Camilo Espitia - Código: 200812115 - Login: jc.espitia912</p>
		
		</div>
		
	</div>
</div>
	
<div class="container general">
  <div class="row">
    <div class="col-md-offset-1 col-md-10" id="viz">
			
		<hr/>  
			<span class="titulo2 texto2">Contexto</span>
			
		
			<p class="texto2">
			En el año 2012, el Tratado de Libre Comercio entre los Estados Unidos y Colombia fue aprobado (Portafolio, 2018). Existían opiniones encontradas sobre sus ventajas y desventajas para el país. Uno de los principales argumentos hacía referencia a la historia de los tratados de Estados Unidos en dónde, el país norteamericano construía barreras arancelarias después de las firmas de los acuerdos, poniendo en desventaja a países con menor poder económico. Por ejemplo, en México fueron creados los subsidios para favorecer los productos del sector agrícola estadounidense, debilitando el sector local (López, 2011).
			</p>
			 
			<span class="titulo2 texto2">Objetivo</span>
		  
			<p class="texto2">
				En teoría, un tratado debería incrementar tanto la eficiencia como la tasa de crecimiento económico de un país.  Esta visualización tiene el objetivo de mostrarnos el antes y el después de las exportaciones de Colombia a Estados Unidos de los productos tradicionales como el Café, el Carbón, el Petróleo, los Derivados del Petróleo y el Ferroníquel, para ver si efectivamente el tratado de libre comercio incrementó las exportaciones o las disminuyó.
			</p>
		<hr/>
		<br/>
		
		<div class="texto">  
			  <span class="titulo2">WHY</span>
			  
			  <p><strong>Tarea principal</strong>
			  <p><strong>T1. Summarize - Trends: (Variation)</strong> Encontrar la tendencia creciente o descendiente de las exportaciones de los productos tradicionales Colombianos de las últimas decadas para evaluar el efecto del TLC firmado con Estados Unidos.
			  <p><strong>Tareas secundarias</strong><br/>
			  <p><strong>T2. Identify - Extremes: </strong> Encontrar los años de mayor variación tanto positiva como negativa de cada producto para analizar posibles razones.
			  <p><strong>T3. Compare - Trends:</strong> Comparar las tendencias de exportación de los productos tradicionales.
				
			  <p>
			  <span class="titulo2">WHAT</span>
			  
			  <p>
			  La visualización se basa en una Tabla obtenida del sitio web de datos abiertos. 
			  Sin embargo, se creó un nuevo dataset temporal dejando por fuera las exportaciones de productos no tan relevantes y la información extra.
			<p><strong>Dataset Type:</strong> Temporal.
			<p><strong>Dataset Availability:</strong> Static.
			<p><strong>Attributes: </strong>
			<p><ul>
				<li>Attribute: Producto.  Type: Categorical </li>
				<li>Attribute: Variación anual de la exportación.  Type: Quantitative-Diverging </li>
				<li>Attribute: Año.  Type: Quantitative-Sequential </li>
			</ul>
			 </p>
				  
			  <span class="titulo2">HOW</span>
			  <p><strong>Idiom:</strong> Linechart.
			  <p><strong>Marks:</strong> Points, lines as connectors.
			
			<p><strong>Channels: </strong>
			<p><ul>
				<li>Position (Y): Para el atributo cuantitativo divergente variación. (Express)</li>
				<li>Separated and ordered by key attribute (Year) horizontally.</li>
			</ul>
			 </p>  
			
	</div>
	
	<br/>
	<br/>
	<div class="parallax"></div>
	<br/>
	<div class="text-center">
	<div class="row">
		<div class="text-center col-md-offset-2 col-md-8">
			<span class="titulo">¿Qué pasó con el TLC Colombia?</span>
			<br/><h4>
			Las exportaciones del Carbón y el Petróleo, dos de los productos más relevantes para Colombia han caído después del TLC.
			</h4>
		</div>
	</div>
	</div>
	<br/>
	
	  <span class="titulo2">Instrucciones de uso:</span>
	  <br/>1. Seleccione en el dropdown el grupo de datos que desea visualizar (Agregado o por productos). 
	  <br/>2. Al pasar el mouse sobre uno de los puntos podrá ver en detalle el porcentaje de variación para el año.</p>
		<select name="cars" id="selector">
		  <option value="0">General</option>
		  <option value="1">Café</option>
		  <option value="2">Carbón</option>
		  <option value="3">Derivados del petróleo</option>
		  <option value="4">Ferroniquel</option>
		  <option value="5">Petróleo</option>
		  
		</select>

<script type="text/javascript">
	var margin = {top: 30, right: 50, bottom: 40, left:40};
	var width = 960 - margin.left - margin.right;
	var height = 500 - margin.top - margin.bottom;

	var div = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);
	
	var svg = d3.select('#viz')
		.append('svg')
		.attr('width', width + margin.left + margin.right)
		.attr('height', height + margin.top + margin.bottom)
	.append('g')
		.attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

	// The API for scales have changed in v4. There is a separate module d3-scale which can be used instead. The main change here is instead of d3.scale.linear, we have d3.scaleLinear.
	var xScale = d3.scaleLinear()
		.range([0, width]);

	var yScale = d3.scaleLinear()
		.range([height, 0]);

	// square root scale.
	var radius = d3.scaleSqrt()
		.range([2,5]);

	// the axes are much cleaner and easier now. No need to rotate and orient the axis, just call axisBottom, axisLeft etc.
	var xAxis = d3.axisBottom()
		.scale(xScale);

	var yAxis = d3.axisLeft()
		.scale(yScale);

	
	//cargo los datos
	d3.dsv(",", "tradicionales.csv", function(d) {
		return { //Anio,Cafe,Carbon,Derivados,Ferroniquel,Petroleo
			Anio : +d.Anio,
			Cafe : +d.Cafe,
			Carbon : +d.Carbon,
			Derivados : +d.Derivados,
			Ferroniquel : +d.Ferroniquel,
			Petroleo : +d.Petroleo,
			General : +d.General
			
		};
	}).then(function(data) {
		console.log(data);					
		
		// 7. d3's line generator
		var line = d3.line()
		.x(function(d) { return xScale(d.key); }) // set the x values for the line generator
		.y(function(d) { return yScale(d.value); }) // set the y values for the line generator 
		.curve(d3.curveMonotoneX) // apply smoothing to the line

		// 8. An array of objects of length N. Each object has key -> value pair, the key being "y" and the value is a random number
		//no sirve . var dataSize = 27;
		//no sirve . var dataset = d3.range(dataSize).map(function(d) { return {"y": d.Cafe } })
		dataset = d3.nest()
			  .key(function(d) {return d.Anio})
			  .rollup(function(v) { return d3.sum(v, function(d) { return +d.General})})
			  .entries(data)
		
		dataset1 = d3.nest()
			  .key(function(d) {return d.Anio})
			  .rollup(function(v) { return d3.sum(v, function(d) { return +d.Cafe})})
			  .entries(data)
		
		dataset2 = d3.nest()
			  .key(function(d) {return d.Anio})
			  .rollup(function(v) { return d3.sum(v, function(d) { return +d.Carbon})})
			  .entries(data)
		
		dataset3 = d3.nest()
			  .key(function(d) {return d.Anio})
			  .rollup(function(v) { return d3.sum(v, function(d) { return +d.Derivados})})
			  .entries(data)
			 
		dataset4 = d3.nest()
			  .key(function(d) {return d.Anio})
			  .rollup(function(v) { return d3.sum(v, function(d) { return +d.Ferroniquel})})
			  .entries(data)
			  
		dataset5 = d3.nest()
			  .key(function(d) {return d.Anio})
			  .rollup(function(v) { return d3.sum(v, function(d) { return +d.Petroleo})})
			  .entries(data)
		
		//ahora va aqui el chart
		xScale.domain(d3.extent(data, function(d){
			return d.Anio;
		})).nice();

		//dominio por defecto - General
		yScale.domain(d3.extent(data, function(d){
			return d.General;
		})).nice();
		
		
		// adding axes is also simpler now, just translate x-axis to (0,height) and it's alread defined to be a bottom axis. 
		svg.append('g')
			.attr('transform', 'translate(0,' + (yScale(0)) + ')')
			.attr('class', 'xaxis')
			.call(xAxis);

		// y-axis is translated to (0,0)
		svg.append('g')
			.attr('transform', 'translate(0,0)')
			.attr('class', 'yaxis')
			.call(yAxis);  
  		
		// adding label. For x-axis, it's at (10, 10), and for y-axis at (width, height-10).
			svg.append('text')
				.attr('x', 10)
				.attr('y', 10)
				.attr('class', 'label')
				.text('Variación %');

			svg.append('text')
				.attr('x', width)
				.attr('y', yScale(0) - 10)
				.attr('text-anchor', 'end')
				.attr('class', 'label')
				.text('Año');

		
		// 9. Append the path, bind the data, and call the line generator 
		svg.append("path")
		.datum(dataset) // 10. Binds data to the line
		.attr("d", line) // 11. Calls the line generator 
		.attr("stroke", "#022d07")
		.attr("stroke-width", 2)
		.attr("fill", "none");	

		//añanir burbujas
		var bubble = svg.selectAll('.bubble')
			.data(dataset)
			.enter().append('circle')
			.attr('class', 'bubble')
			.attr('cx', function(d){return xScale(d.key);})
			.attr('cy', function(d){ return yScale(d.value); })
			.attr('r', function(d){ return 4; })
			.style('fill', "#A07A19")
			.on("mouseover", function(d) {
				div.transition()
				.duration(200)
				.style("opacity", .9);
				div.html("<br/>Año: "+d.key +"<br/>Variación: "+d.value +"%")
				.style("left", (d3.event.pageX) + "px")
				.style("top", (d3.event.pageY - 28) + "px");
			})
			.on("mouseout", function(d) {
				div.transition()
				.duration(500)
				.style("opacity", 0);
			});
		
		
		//cambiar datase
		d3.select('#selector')
			.on("change", function () {
			selectedValue = d3.select('#selector').property('value');
			console.log(selectedValue);
			
			switch (+selectedValue) {
				case 0:
					svg.selectAll('.label2').text('Tendencia General');
					update(dataset);
					break;
				case 1:
					svg.selectAll('.label2').text('Café');
					update(dataset1);
					break;
				case 2:
					svg.selectAll('.label2').text('Carbón');
					update(dataset2);
					break;
				case 3:
					svg.selectAll('.label2').text('Derivados del Petróleo');
					update(dataset3);
					break;
				case 4:
					svg.selectAll('.label2').text('Ferroníquel');
					update(dataset4);
					break;
				case 5:
					svg.selectAll('.label2').text('Petróleo');
					update(dataset5);
					break;
			}
		
		});
		
		//update dataset
		function update(newData) {
			
			//Realizo la selección del update
			var update = svg.selectAll('path')
			.data(newData, function (d) { return d })
			
			//Quito los ejes
			svg.selectAll('.yaxis')
			.remove();
			svg.selectAll('.xaxis')
			.remove();
			svg.selectAll('.label')
			.remove();
			svg.selectAll('.label')
			.remove();
			
			//quita los puntos
			svg.selectAll('.bubble')
			.remove();
			
			//cambio el dominio de Y
			yScale.domain(d3.extent(newData, function(d){
				return d.value;
			})).nice();
			
			//Agrego los ejes de nuevo.
			//Adding axes is also simpler now, just translate x-axis to (0,height) and it's alread defined to be a bottom axis. 
			svg.append('g')
				.attr('transform', 'translate(0,' + yScale(0) + ')')
				.attr('class', 'xaxis')
				.call(xAxis);

			// y-axis is translated to (0,0)
			svg.append('g')
				.attr('transform', 'translate(0,0)')
				.attr('class', 'yaxis')
				.call(yAxis);  
			
			// adding label. For x-axis, it's at (10, 10), and for y-axis at (width, height-10).
			svg.append('text')
				.attr('x', 10)
				.attr('y', 10)
				.attr('class', 'label')
				.text('Variación %');

			svg.append('text')
				.attr('x', width)
				.attr('y', yScale(0) - 10)
				.attr('text-anchor', 'end')
				.attr('class', 'label')
				.text('Año');
					
			//el nuevo path que no pinta nada...
			var enter = update.enter()        
			  .append("path")
				.attr("d", line)
				.attr("fill", "none")
				.attr("stroke-width", 4)
				.attr("stroke", "black");
			
			//Dibuja el nuevo dataset, si funciona... pero no usa update
			svg.append("path")
				.datum(newData) // 10. Binds data to the line 
				.attr("d", line) // 11. Calls the line generator 
				.attr("stroke", "#022d07")
				.attr("stroke-width", 2)
				.attr("fill", "none");
			
				//añanir burbujas
			var bubble = svg.selectAll('.bubble')
				.data(newData)
				.enter().append('circle')
				.attr('class', 'bubble')
				.attr('cx', function(d){return xScale(d.key);})
				.attr('cy', function(d){ return yScale(d.value); })
				.attr('r', function(d){ return 4; })
				.style('fill', "#A07A19")
				.on("mouseover", function(d) {
					div.transition()
					.duration(200)
					.style("opacity", .9);
					div.html("<br/>Año: "+d.key +"<br/>Variación: "+d.value+"%")
					.style("left", (d3.event.pageX) + "px")
					.style("top", (d3.event.pageY - 28) + "px");
				})
				.on("mouseout", function(d) {
					div.transition()
					.duration(500)
					.style("opacity", 0);
				});
			
			//borra el exit de la selección
			var exit = update.exit()
			.remove();
			//update.merge(enter);		
			//.call(pulse);		
			
		}
		
		//titulo de la leyenda
		svg.append('text')
			.attr('x', width + 16)
			.attr('y', height - 390)
			.attr('text-anchor', 'end')
			.attr('class', 'label2')
			.text('Tendencia general');
		
	
		
	});

</script>
<br/>
<br/>

	  <span class="titulo2 texto2">Insights:</span>
	  <p >
	  La visualización nos permite obtener los siguientes insights: 
		<ul>
			<li class="texto2">La variación general de las exportaciones de los productos tradicionales comenzó a disminuir año tras año después de la firma del TLC con Estados Unidos, encontrando el pico más bajo en el año 2015. Desde entonces la disminución de las exportaciones se ha detenido pero apenas hasta dejar de disminuir año tras año.</li>
			<li class="texto2">El Carbón y el Petróleo también encontraron sus picos más bajos en el año 2015 y en general muestran una tendencia decreciente desde 2012, cuando fue aprobado el TLC.</li>
			<li class="texto2">El Café ha comenzado a variar mucho menos con respecto a las dos décadas anteriores al TLC, sin embargo, no muestra un crecimiento, tan sólo disminución en la variación.</li>
			<li class="texto2">Por el contrario, el ferroníquel, encontró su pico más alto en 2014 después de la firma del tratado y su pico más bajo el año siguiente, probablemente por una demanda extra en 2014.</li>
			<li class="texto2">Por último, los productos derivados del Petróleo han mantenido una variación similar a la del periodo previo a la firma del tratado.</li>
			<li class="texto2">En conclusión, las exportaciones de dos de los productos más significativos de los productos tradicionales que exporta Colombia han caído, mientras que los demás se han mantenido o alcanzado una estabilidad. Sin embargo, ninguno ha presentado un aumento en la variación de las exportaciones, negando directamente el efecto esperado del TLC al brindarle a Colombia el acceso al muy significativo mercado norteamericano.</li>
		</ul>
	</p>
<br/>
		
	<br/>
	<div class="parallax2"></div>
	<br/>
	
	<div class="texto2">
		<span class="titulo2">LICENSE:</span>
		<p>
		Copyright 2018 Camilo Espitia
		<br/> <br/>
		Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
		<br/><br/>
		The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
		<br/><br/>
		THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
		</p>
	</div>
	

	</div>
	</div>
	</div>
</body>
</html>






