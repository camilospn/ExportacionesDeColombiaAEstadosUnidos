<!DOCTYPE html>
<html lang="en">
<head>

	<meta charset="UTF-8">
	<title>Exportaciones de productos tradicionales a Estados Unidos</title>
	<style type="text/css">
		.general{			
			font-family: 'Alegreya', serif;
			font-size: 18px;			
		}

		.label{
			font-size: 18px;
			font-family: 'Alegreya', serif;
		}
		.legend text,
		.axis text {
			font-size: 13px;
			fill: #333;
		}

		.axis path,
		.axis line{
			fill: none;
			stroke-width: 1px;
			stroke: #777;
		}

		.circle{
			fill-opacity: 0.65;
		}

		.bubble{
			opacity: 1;
			transition: opacity 0.3s;
		}

		.bubble:hover text{
			opacity: 1;
		}

		.bubble:hover circle{
			fill-opacity: 1;
		}

		.legend rect{
			fill-opacity: 0.75;
		}

		.legeng:hover rect{
			fill-opacity:1;
		}		

		div.tooltip {
		  position: absolute;
		  text-align: center;
		  width: 180px;
		  height: 70px;
		  padding: 2px;
		  font: 12px sans-serif;
		  background: #0c0c0c;
		  color: white;
		  border: 0px;
		  border-radius: 8px;
		  pointer-events: none;
		}
		
		.buttonR {
			font-size: 13px;
			fill: #333;	
			font-weight: bold;			
		}
		
		h1 {
			font-weight: bold;
			color: #fff;
			font-size: 26px;
			font-family: 'Alegreya', serif;
		}
		
		.titulo {
			font-weight: bold;
			font-family: 'Alegreya', serif;
			font-size: 46px;
			color:  #022d07;
		}
		.titulo2 {
			font-weight: bold;
			font-family: 'Alegreya', serif;
			font-size: 30px;
			color:  #022d07;
		}
		.texto {
			-webkit-column-count: 3; /* Chrome, Safari, Opera */
			-moz-column-count: ; /* Firefox */
			column-count: 2;
			-webkit-column-gap: 40px; /* Chrome, Safari, Opera */
			-moz-column-gap: 40px; /* Firefox */
			column-gap: 80px;

			text-align: justify;
			text-justify: inter-word;
			
		}
		.texto2 {
			text-align: justify;
			text-justify: inter-word;			
		}
		.parallax2 {
			/* The image used */
			background-image: url("economy2.jpg");

			/* Set a specific height */
			min-height: 200px; 
			

			/* Create the parallax scrolling effect */
			background-attachment: fixed;
			background-position: center;
			background-repeat: no-repeat;
			background-size: cover;
		}

		.parallax {
			/* The image used */
			background-image: url("economy.jpg");

			/* Set a specific height */
			min-height: 150px; 
			

			/* Create the parallax scrolling effect */
			background-attachment: fixed;
			background-position: center;
			background-repeat: no-repeat;
			background-size: cover;
		}

		
	</style>
	<link href="https://fonts.googleapis.com/css?family=Alegreya" rel="stylesheet"> 
	<script type="text/javascript" src="https://d3js.org/d3.v5.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>
<br/>
<br/>
<br/>
<div class="text-center general">
	<div class="row">
		<div class="text-center col-md-offset-3 col-md-6">
			<span class="titulo">¡Colombia no explota el TLC que firmó con Estados Unidos!</span>
			<br/><h4>X
			</h4>
		<p>	Creado por: Camilo Espitia - Código: 200812115 - Login: jc.espitia912</p>
		
		</div>
		
	</div>
</div>
	
<div class="container general">
  <div class="row">
    <div class="col-md-offset-1 col-md-10" id="viz">
		
		
			
		<hr/>  
			<span class="titulo2">Contexto</span>
			
		
			<p>X:<br/>
			<br/>Y
			<br/>Z
			</p>
			 
			<span class="titulo2">Objetivo</span>
		  
			<p> Encontrar la tendencia de exportaciones de los productos tradicionales Colombianos de las últimas decadas para evaluar el efecto del TLC firmado con Estados Unidos.
			<br/>Encontrar productos con tendencias atípicas a la tendencia general de exportación de los productos tradicionales.
			<br/>Comparar las tendencias de exportación de los productos tradicionales.</p>
		<hr/>
		<br/>
		
		<div class="texto">  
			  <span class="titulo2">WHY</span>
			  
			  <p><strong>Tarea principal</strong>
			  <p><strong>T1. Summarize - Trends: (Variation)</strong> Encontrar la tendencia creciente o descendiente de las exportaciones de los productos tradicionales Colombianos de las últimas decadas para evaluar el efecto del TLC firmado con Estados Unidos.
			  <p><strong>Tareas secundarias</strong><br/>
			  <p><strong>T2. Identify - Extremes: </strong> Encontrar los años de mayor variación tanto positiva como negativa de cada producto para analizar posibles razones.
			  <p><strong>T3. Compare - Trends:</strong> Comparar las tendencias de exportación de los productos tradicionales.
				
			  <p>
			  <span class="titulo2">WHAT</span>
			  
			  <p>
			  La visualización se basa en una Tabla obtenida del sitio web de datos abiertos. 
			  Sin embargo, se creó un nuevo dataset temporal dejando por fuera las exportaciones de productos no tan relevantes y la información extra.
			<p><strong>Dataset Type:</strong> Temporal.
			<p><strong>Dataset Availability:</strong> Static.
			<p><strong>Attributes: </strong>
			<p><ul>
				<li>Attribute: Producto.  Type: Categorical </li>
				<li>Attribute: Variación anual de la exportación.  Type: Quantitative-Diverging </li>
				<li>Attribute: Año.  Type: Quantitative-Sequential </li>
			</ul>
			 </p>
				  
			  <span class="titulo2">HOW</span>
			  <p><strong>Idiom:</strong> Linechart.
			  <p><strong>Marks:</strong> Lines.
			
			<p><strong>Channels: </strong>
			<p><ul>
				<li>Position: Para el atributo cuantitativo divergente variación. </li>
			</ul>
			 </p>
			
			<strong>Express:</strong> En X para el tiempo y en Y para la variación.	  
			
	</div>
	
	<br/>
	<br/>
	<div class="parallax"></div>
	<br/>
	<div class="text-center">
	<div class="row">
		<div class="text-center col-md-offset-2 col-md-8">
			<span class="titulo">¡Colombia no explota el TLC que firmó con Estados Unidos!</span>
			<br/><h4>X
			</h4>
		</div>
	</div>
	</div>
	<br/>
	
	  <span class="titulo2">Instrucciones de uso:</span>
	  <br/>1. Seleccione en el dropdown el grupo de datos que desea visualizar (Agregado o por productos). 
	  <br/>2. Tooltip?</p>
		<select name="cars" id="selector">
		  <option value="0">General</option>
		  <option value="1">Café</option>
		  <option value="2">Carbón</option>
		  <option value="3">Derivados</option>
		  <option value="4">Ferroniquel</option>
		  <option value="5">Petróleo</option>
		  
		</select>

<script type="text/javascript">
	var margin = {top: 30, right: 50, bottom: 40, left:40};
	var width = 960 - margin.left - margin.right;
	var height = 500 - margin.top - margin.bottom;

	var div = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);
	
	var svg = d3.select('#viz')
		.append('svg')
		.attr('width', width + margin.left + margin.right)
		.attr('height', height + margin.top + margin.bottom)
	.append('g')
		.attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

	// The API for scales have changed in v4. There is a separate module d3-scale which can be used instead. The main change here is instead of d3.scale.linear, we have d3.scaleLinear.
	var xScale = d3.scaleLinear()
		.range([0, width]);

	var yScale = d3.scaleLinear()
		.range([height, 0]);

	// square root scale.
	var radius = d3.scaleSqrt()
		.range([2,5]);

	// the axes are much cleaner and easier now. No need to rotate and orient the axis, just call axisBottom, axisLeft etc.
	var xAxis = d3.axisBottom()
		.scale(xScale);

	var yAxis = d3.axisLeft()
		.scale(yScale);

	// again scaleOrdinal
	var colorScale = d3.scaleOrdinal(["#022d07", "#A07A19", "#EB9A72", "#BA86F5", "#EA22A8"]);

	d3.dsv(",", "tradicionales.csv", function(d) {
		return { //Anio,Cafe,Carbon,Derivados,Ferroniquel,Petroleo
			Anio : +d.Anio,
			Cafe : +d.Cafe,
			Carbon : +d.Carbon,
			Derivados : +d.Derivados,
			Ferroniquel : +d.Ferroniquel,
			Petroleo : +d.Petroleo
			
		};
	}).then(function(data) {
		console.log(data);
		
					
		
		// 7. d3's line generator
		var line = d3.line()
		.x(function(d) { return xScale(d.key); }) // set the x values for the line generator
		.y(function(d) { return yScale(d.value); }) // set the y values for the line generator 
		.curve(d3.curveMonotoneX) // apply smoothing to the line

		// 8. An array of objects of length N. Each object has key -> value pair, the key being "y" and the value is a random number
		//no sirve . var dataSize = 27;
		//no sirve . var dataset = d3.range(dataSize).map(function(d) { return {"y": d.Cafe } })
		dataset = d3.nest()
			  .key(function(d) {return d.Anio})
			  .rollup(function(v) { return d3.sum(v, function(d) { return +d.Cafe})})
			  .entries(data)
		
		dataset1 = d3.nest()
			  .key(function(d) {return d.Anio})
			  .rollup(function(v) { return d3.sum(v, function(d) { return +d.Cafe})})
			  .entries(data)
		
		dataset2 = d3.nest()
			  .key(function(d) {return d.Anio})
			  .rollup(function(v) { return d3.sum(v, function(d) { return +d.Carbon})})
			  .entries(data)
		
		dataset3 = d3.nest()
			  .key(function(d) {return d.Anio})
			  .rollup(function(v) { return d3.sum(v, function(d) { return +d.Derivados})})
			  .entries(data)
			 
		dataset4 = d3.nest()
			  .key(function(d) {return d.Anio})
			  .rollup(function(v) { return d3.sum(v, function(d) { return +d.Ferroniquel})})
			  .entries(data)
			  
		dataset5 = d3.nest()
			  .key(function(d) {return d.Anio})
			  .rollup(function(v) { return d3.sum(v, function(d) { return +d.Petroleo})})
			  .entries(data)
		
		//ahora va aqui el chart
		xScale.domain(d3.extent(data, function(d){
			return d.Anio;
		})).nice();

		//dominio por defecto - General
		yScale.domain(d3.extent(data, function(d){
			return d.Cafe;
		})).nice();
		
		
		// adding axes is also simpler now, just translate x-axis to (0,height) and it's alread defined to be a bottom axis. 
		svg.append('g')
			.attr('transform', 'translate(0,' + (yScale(0)) + ')')
			.attr('class', 'xaxis')
			.call(xAxis);

		// y-axis is translated to (0,0)
		svg.append('g')
			.attr('transform', 'translate(0,0)')
			.attr('class', 'yaxis')
			.call(yAxis);  
  		
		// adding label. For x-axis, it's at (10, 10), and for y-axis at (width, height-10).
			svg.append('text')
				.attr('x', 10)
				.attr('y', 10)
				.attr('class', 'label')
				.text('Variación %');

			svg.append('text')
				.attr('x', width)
				.attr('y', yScale(0) - 10)
				.attr('text-anchor', 'end')
				.attr('class', 'label')
				.text('Año');

		
		// 9. Append the path, bind the data, and call the line generator 
		svg.append("path")
		.datum(dataset) // 10. Binds data to the line
		.attr("d", line) // 11. Calls the line generator 
		.attr("stroke", colorScale)
		.attr("stroke-width", 2)
		.attr("fill", "none");	

		
		d3.select('#selector')
			.on("change", function () {
			selectedValue = d3.select('#selector').property('value');
			console.log(selectedValue);
			
			switch (+selectedValue) {
				case 0:
					update(dataset);
					break;
				case 1:
					update(dataset1);
					break;
				case 2:
					update(dataset2);
					break;
				case 3:
					update(dataset3);
					break;
				case 4:
					update(dataset4);
					break;
				case 5:
					update(dataset5);
					break;
			}
		
		});
		
		//update dataset
		function update(newData) {
			
			//Realizo la selección del update
			var update = svg.selectAll('path')
			.data(newData, function (d) { return d })
			
			//Quito los ejes
			svg.selectAll('.yaxis')
			.remove();
			svg.selectAll('.xaxis')
			.remove();
			svg.selectAll('.label')
			.remove();
			svg.selectAll('.label')
			.remove();
			
			//cambio el dominio de Y
			yScale.domain(d3.extent(newData, function(d){
				return d.value;
			})).nice();
			
			//Agrego los ejes de nuevo.
			//Adding axes is also simpler now, just translate x-axis to (0,height) and it's alread defined to be a bottom axis. 
			svg.append('g')
				.attr('transform', 'translate(0,' + yScale(0) + ')')
				.attr('class', 'xaxis')
				.call(xAxis);

			// y-axis is translated to (0,0)
			svg.append('g')
				.attr('transform', 'translate(0,0)')
				.attr('class', 'yaxis')
				.call(yAxis);  
			
			// adding label. For x-axis, it's at (10, 10), and for y-axis at (width, height-10).
			svg.append('text')
				.attr('x', 10)
				.attr('y', 10)
				.attr('class', 'label')
				.text('Variación %');

			svg.append('text')
				.attr('x', width)
				.attr('y', yScale(0) - 10)
				.attr('text-anchor', 'end')
				.attr('class', 'label')
				.text('Año');
					
			//el nuevo path que no pinta nada...
			var enter = update.enter()        
			  .append("path")
				.attr("d", line)
				.attr("fill", "none")
				.attr("stroke-width", 4)
				.attr("stroke", "black");
			
			//Dibuja el nuevo dataset, si funciona... pero no usa update
			svg.append("path")
				.datum(newData) // 10. Binds data to the line 
				.attr("d", line) // 11. Calls the line generator 
				.attr("stroke", colorScale)
				.attr("stroke-width", 2)
				.attr("fill", "none");
			
			//borra el exit de la selección
			var exit = update.exit()
			.remove();
			//update.merge(enter);		
			//.call(pulse);		
			
		}
			
		//var bubble = svg.selectAll('.bubble')
		//	.data(data)
		//	.enter().append('circle')
		//	.attr('class', 'bubble')
		//	.attr('cx', function(d){return xScale(d.Habitantes);})
		//	.attr('cy', function(d){ return yScale(d.Bibliotecas); })
		//	.attr('r', function(d){ return 8; })
		//	.style('fill', function(d){ return colorScale(d.Region); })
		//	.on("mouseover", function(d) {
		//		div.transition()
		//		.duration(200)
		//		.style("opacity", .9);
		//		div.html("<br/>Departamento: "+d.Departamento +"<br/>Habitantes: "+d.Habitantes + "<br/>Bibliotecas: " + d.Bibliotecas)
		//		.style("left", (d3.event.pageX) + "px")
		//		.style("top", (d3.event.pageY - 28) + "px");
		//	})
		//	.on("mouseout", function(d) {
		//		div.transition()
		//		.duration(500)
		//		.style("opacity", 0);
		//	});

		

		// I feel I understand legends much better now.
		// define a group element for each color i, and translate it to (0, i * 20). 
		//var legend = svg.selectAll('legend')
			//.data(colorScale.domain())
			//.enter().append('g')
			//.attr('class', 'legend')
			//.attr('transform', function(d,i){ return 'translate(0,' + (50 + i * 20) + ')'; });

		// give x value equal to the legend elements. 
		// no need to define a function for fill, this is automatically fill by color.
		//legend.append('rect')
			//.attr('x', width)
			//.attr('width', 18)
			//.attr('height', 18)
			//.style('fill', colorScale);

		// add text to the legend elements.
		// rects are defined at x value equal to width, we define text at width - 6, this will print name of the legends before the rects.
		//legend.append('text')
			//.attr('x', width - 6)
			//.attr('y', 9)
			//.attr('dy', '.35em')
			//.style('text-anchor', 'end')
			//.text(function(d){ return Object.keys(d); });

		//boton para reestablecer			
		//svg.append('rect')
		//	.attr('x', width - 100)
		//	.attr('y', height - 280)
		//	.attr('width', 118)
		//	.attr('height', 30)
		//	.style('fill', '#c7d9e8') // quitar el filtro
		//	.on('click', function(type){
		//	d3.selectAll('.bubble')
		//		.style('opacity', 1);
		//})

		//svg.append('text')
		//	.attr('x', width)
		//	.attr('y', height - 260)
		//	.attr('text-anchor', 'end')
		//	.attr('class', 'buttonR')
		//	.text('Reestablecer') 	// quitar el filtro
		//	.on('click', function(type){
		//	d3.selectAll('.bubble')
		//		.style('opacity', 1);
		//})
		
		//titulo de la leyenda
		svg.append('text')
			.attr('x', width + 16)
			.attr('y', height - 390)
			.attr('text-anchor', 'end')
			.attr('class', 'buttonR')
			.text('LEYENDA');
		
			
		// d3 has a filter fnction similar to filter function in JS. Here it is used to filter d3 components.
		//legend.on('click', function(type){
		//	d3.selectAll('.bubble')
		//		.style('opacity', 0.15)
		//		.filter(function(d){
		//			return d.Region == type;
		//		})
		//		.style('opacity', 1);
		//})		
		
	//Codigo de arriba que no servia...		
			//Carbon			
	// 9. Append the path, bind the data, and call the line generator 
	//svg.append("path")
    //.datum(dataset2) // 10. Binds data to the line 
    //.attr("class", "line") // Assign a class for styling 
    //.attr("d", line) // 11. Calls the line generator 
	//.attr("stroke", colorScale)
    //.attr("stroke-width", 4)
    //.attr("fill", "none");	
	
	//no sirvio
	//svg.selectAll("path")
    //.data( d3.range(10) )
    //.enter()
    //.append("circle")
    //.attr("r", 18 )
    //.attr("cx", d3.scale.linear().domain([-1, 10]).range([0, 400]) )
    //.attr("cy", 25)
    //.attr("stroke", colorScale );

		
	});

</script>
<br/>
<br/>

	  <span class="titulo2 texto2">Insights:</span>
	  <p >
	  La visualización nos permite obtener los siguientes insights: 
		<ul>
			<li class="texto2">La visualización nos muestra que efectivamente existe una correlación entre el número de habitantes de un departamento y el número de bibliotecas públicas encontradas en cada territorio. La correlación es positiva, entre más habitantes, más bibliotecas podemos encontrar. </li>
			<li class="texto2">Según la visualización Bogotá, se encuentra muy lejos de tener suficientes bibliotecas públicas para la cantidad de habitantes que tiene, comparado con el resto de país. <strong>En Bogotá, cada una de las 19 bibliotecas públicas debería atender más de 400 mil personas.</strong></li>
			<li class="texto2">Sobre todo resulta interesante observar que Antioquia, el departamento con el número de habitantes más cercano a Bogotá, si tiene un número de bibliotecas que corresponde a la tendencia general del país.</li>
			<li class="texto2">La región Andina es la que presenta mayor dispersión y también es la que contiene los outliers. Por una parte se encuentra Bogotá con muy pocas bibliotecas para sus habitantes, mientras que Boyacá tiene demasiadas bibliotecas en relación con la tendencia del país.</li>
		</ul>
	</p>
<br/>
		
	<br/>
	<div class="parallax2"></div>
	<br/>
	
	<div class="texto2">
		<span class="titulo2">LICENSE:</span>
		<p>
		Copyright 2018 Camilo Espitia
		<br/> <br/>
		Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
		<br/><br/>
		The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
		<br/><br/>
		THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
		</p>
	</div>
	

	</div>
	</div>
	</div>
</body>
</html>






